##
# -------------------------------------------------------------------------  
#   Copyright (c) 2017 Hardware-Software-Co-Design, Friedrich-
#   Alexander-Universitaet Erlangen-Nuernberg (FAU), Germany.
#   All rights reserved.
#
#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.
# ------------------------------------------------------------------------- 
#                                                                               
#  @author Streit Franz-Josef                                                    
#  @mail    franz-josef.streit@fau.de                                                   
#  @date   09 November 2017                                                      
#  @version 0.1                                                                  
#  @brief adapted Vivado HLS tcl file  
#                 Copyright (C) 2014 Xilinx Inc. All rights reserved.
#
##

set SRCDIR         "@src_path@"
set INCLUDE_FLAGS  "@include_flags@"
set IPB_NAME       "@ipbName@"
set DEVICE         "@device@"
set CLK            "@clk@" 
set SYN_OPT        "@syn_opt@" 


open_project -reset VivadoHLS_${IPB_NAME}
set_top ${IPB_NAME}
add_files ${SRCDIR}/${IPB_NAME}.cpp -cflags ${INCLUDE_FLAGS}
add_files -tb ${SRCDIR}/dummy.cpp -cflags ${INCLUDE_FLAGS}
open_solution -reset "solution1"
set_part ${DEVICE} -tool vivado
create_clock -period ${CLK} -name default 
config_rtl -reset control -reset_level low
#config_dataflow -default_channel fifo

csynth_design
switch ${SYN_OPT} {
  accurate {
    export_design -rtl vhdl -evaluate vhdl -flow impl -format ip_catalog -description "IP generated by VivadoHLS" -vendor "FAU" -library "simulink_blocks" -version "1.0" -display_name ${IPB_NAME} 
  }
  default {
    export_design -format ip_catalog -description "IP generated by VivadoHLS" -vendor "FAU" -library "simulink_blocks" -version "1.0" -display_name ${IPB_NAME} 
  }
} 
exit
